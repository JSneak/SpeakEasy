<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="style.css">
        <title> Client </title>
        <style>
            p.hidden{
            display: none;
            }
            p.visible{
            display: block;
            }
            h2.hidden{
            display: none;
            }
            h2.visible{
            display: block;
            }
        </style>
        <script src="https://cdn.socket.io/socket.io-1.4.0.js"></script>
        <script>
            var url = window.location.href;
                  var arr = url.split("/");
                  var result = arr[0] + "//" + arr[2];
                  var socket = io.connect(result);
                  var SessionCode;
                  var playerCount = 0; //sets from server
                  var UserName = "";
                  var Code;
                  var onAList = 0;
                  //The things still dissapear when the code is false
                  function JoinSession() //Join the session
                  {
                      UserName = document.getElementById("name").value;
                      Code = document.getElementById("code").value;
                      document.getElementById("Screen1").className = "hidden"
                      document.getElementById("Screen2").className = "hidden"
                      document.getElementById("JoinServer").innerHTML = "People in Session"
                      var Data = {
                          dataName: UserName,
                          dataCode: Code
                      };
                      socket.emit('join session', Data);
            
                  }
            
                  socket.on('user recieve code', function(data) {
                      SessionCode = data.Code;
                  });
            
                  socket.on("displayName", function(data) { //displays all the names
                      if (SessionCode == data.Code) {
                          playersInGame = data.List;
                          playerCount++;
                          document.getElementById("display").innerHTML = data.List;
                      }
                  });
            
                  socket.on("Bad Code", function(data) { //Code invalid alert
                      alert("Code is invalid")
                      document.getElementById("Screen1").className = "visible"
                      document.getElementById("Screen2").className = "visible"
                      document.getElementById("JoinServer").innerHTML = "JOIN SERVER"
                      document.getElementById("JoinServer").className = "visible"
                  });
            
                  socket.on("start session", function(data) { //Is called when the Host presses start
                      if (SessionCode == data.Code) {
                          document.getElementById("Screen2").className = "visible";
                          document.getElementById("Submit").value = "Put name on the list.";
                          document.getElementById("Submit").onclick = function() {
                              PutNameOn()
                          }
                          document.getElementById("JoinServer").innerHTML = "";
                          document.getElementById("display").innerHTML = "";
                      }
                  });
            
                  socket.on("Added Name", function(data) { //Changes the styling of the buttons
                      onAList = 1;
                      document.getElementById("Submit").value = "Take name off the list."
                      document.getElementById("Submit").onclick = function() {
                          TakeNameOff()
                      }
                      document.getElementById("Submit").className = 'waves-effect waves-light btn-large red lighten-1'
                  });
            
                  socket.on("TookNameOff", function(data) {
                      onAList = 0;
                      document.getElementById("Submit").value = "Put name on the list."
                      document.getElementById("Submit").onclick = function() {
                          PutNameOn()
                      }
                      document.getElementById("Submit").className = 'waves-effect waves-light btn-large'
                  });
            
                  function TakeNameOff() //Take your name off the screen
                  {
                      var Data = {
                          userCode: SessionCode,
                          userName: UserName
                      }
                      socket.emit("Take name off list", Data)
                  }
            
                  function PutNameOn() //Display your name onto the screen
                  {
                      var Data = {
                          userCode: SessionCode,
                          userName: UserName
                      }
                      socket.emit("Add name to list", Data)
                  }
            
                  socket.on("end of session", function(data) {
                      if (SessionCode == data.Code) {
                          socket.disconnect();
                          location.reload();
                      }
                  });
        </script>
    </head>
    <body>
        <font size=5 id="JoinServer" class="visible">Join a SpeakEasy Session</font>
        <form>
            <p id="Screen1" class="visible">
                <br>
                <font size=5>What is your name?</font>
                <input type="text" id="name" placeholder="Name here"><br>
                <br>
                <font size=5>Session Code</font>
                <input type="text" placeholder="Enter session code here" id="code"><br>
            </p>
            <p id="Screen2" class="visible">
                <input type="button" id="Submit" onClick="JoinSession()" class="waves-effect waves-light btn-large light-blue accent-3" value="Submit">
            </p>
        </form>
        <font size=4 id="display"></font> 
    </body>
</html>