<!DOCTYPE HTML>
<html>
	<head>
		<title>Host A New Session</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="style.css">
		<style>
        p.hidden{
            display: none;
        }
        p.visible{
            display: block;
        }
		table, th, td {
		border: 1px solid black;
		}
		</style>
		<script src="https://cdn.socket.io/socket.io-1.4.0.js"></script>
		<script>
			var PlayersInLobby= 0;
			var UserCode;
			//var socket = io.connect('/')
			var socket = io.connect('http://localhost:3000/')
			var Name 
			var PermantOutput="";
			var MilliSeconds;
			var Minutes;
			var Seconds;
			var Timer;
			function ObtainCode()
			{
				Name = document.getElementById("Name").value;
				document.getElementById("Screen1").className = "hidden"
				document.getElementById("Screen2").className = "visible"
				document.getElementById("Useful").innerHTML = "People in Session";
				Minutes = document.getElementById("hostMinutes").value;
				Seconds = document.getElementById("hostSeconds").value;
				MilliSeconds = (Minutes*60000) + (Seconds*1000);
				var Data = {
					hostName: Name
				}
				document.getElementById("Name").value = "";
				socket.emit('Create Session', Data);
			}
			
			function StartGame()
			{
				var data = {
				code:UserCode
				}
				//console.log(data);
				socket.emit("Start Session", data);
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("codeSpace").innerHTML = "";//Empties the line with the Code
				document.getElementById("Useful").innerHTML = "";//Empties the people in the session
				document.getElementById("display").innerHTML =""
				document.getElementById("Screen4").className = "visible"
				Timer = setTimeout(function(){EndSession();},MilliSeconds)//<---- Doesn't Work
			}
			
			
			socket.on("someone buzzed", function(data) {
				if(UserCode == data.Code)
				{
					CurrentTeam = data.PlayerTeam;
					document.getElementById("Useful").innerHTML = ""
					document.getElementById("display").innerHTML = data.PlayerName +" from Team " + data.PlayerTeam + " buzzed in."; 
					document.getElementById("Screen2").className = "visible";
					document.getElementById("Screen4").className = "hidden"
				}
			});
			function countdown(mins,secs){
				while(mins > 0){
					while(secs > 0){
						setInterval(function(){secs--;},1000)
					}
					mins--;
				}
				document.getElementById("TimerSpace").innerHTML= "Time left: " + mins + ":" + secs + ".";
			}
			function EndSession()
			{
				clearTimeout(Timer);
				var data = {
				code:UserCode
				}
				socket.emit("End Session", data);
				socket.disconnect();
				location.reload();
			}
			
	socket.on('recieve code',function (data) {
		UserCode = data.Code;
			document.getElementById("codeSpace").innerHTML = UserCode + " <-- This is Session Code";
		});
			
	socket.on("displayName", function(data) {
		if(UserCode == data.Code)
		{
			PlayersInLobby++;
			document.getElementById("display").innerHTML = data.List;
		}
	});
		</script>
		
	</head>
	
	<body>
	<form>
	<p id="codeSpace"></p>
	<p id="Useful"></p>
	<p id="display"></p>
	<p id="Screen1" class="visible">
	Name <br>
		<input type="text" id='Name'> <br>
	Minutes:Seconds
		<br><input type="number" value="0" name="quantity" min="1" max="60" id="hostMinutes"><input type="number" name="quantity" value="0" min="1" max="60" id="hostSeconds">
		<br>
		<a id="Button1" onClick="obtainCode()" class="waves-effect waves-light btn-large">Start Session</a>
	</p>
	<p id="Screen2" class="hidden">
	<input type="button" value="Start" id="Button2" onclick="StartGame()">
	</p>
	<p id="Screen4" class="hidden">
	<input type="button" value="End Session" id="EndButton" onClick="EndSession()">
	</p>
	<p id="countdownHolder" class="visible">
	</p>
</html>